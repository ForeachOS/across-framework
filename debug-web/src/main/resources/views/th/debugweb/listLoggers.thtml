<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>List and configure loggers</title>
</head>
<body th:fragment="content">
<div class="row">
	<h3>Loggers configuration</h3>

	<div th:if="${feedback}" class="alert alert-dismissable alert-success">
		<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
		<span th:text="${feedback}">XX loggers have been updated.</span>
	</div>

	<form role="form" method="post" onsubmit="disableNonDirty(this)">
		<div class="form-group">
			<input type="reset" value="Reset" class="btn btn-default"/>
			<input type="submit" value="Save" class="btn btn-default"/>
		</div>
		<div class="form-group">
			<table class="table">
				<tr th:each="entry : ${loggers}">
					<td th:text="${entry.key}">logger name</td>
					<td>
						<select onchange="markDirty(event)" th:name="${entry.key}">
							<option th:each="level : ${levels}" th:value="${level}" th:text="${level}"
							        th:selected="${level eq entry.value}">log level
							</option>
						</select>
					</td>
				</tr>
			</table>
		</div>
		<div class="form-group">
			<input type="reset" value="Reset" class="btn btn-default"/>
			<input type="submit" value="Save" class="btn btn-default"/>
		</div>
	</form>

	<div th:replace="th/across :: table (${appenders})"></div>

	<script th:inline="javascript" type="text/javascript">
		/*<![CDATA[*/
		function markDirty( event )
		{
			var target = event.srcElement, isOriginalValue = function ( target )
					{
						for ( var i = 0; i < target.options.length; i++ ) {
							var option = target.options[i];
							if ( option.attributes['selected'] ) {
								return option.value === target.value;
							}
						}
					};
			if ( !isOriginalValue( target ) && target.className.indexOf( 'dirty' ) === -1 ) {
				if ( target.className.length > 0 ) {
					target.className += ' ';
				}
				target.className += 'dirty';
			}
			if ( isOriginalValue( target ) && target.className.indexOf( 'dirty' ) > -1 ) {
				target.className = target.className.replace( / ?\bdirty\b/, '' );
			}
		}
		function disableNonDirty( form )
		{
			var selectNodes = document.getElementsByTagName( 'select' );
			for ( var i = 0; i < selectNodes.length; i++ ) {
				var node = selectNodes[i];
				if ( node.className.indexOf( 'dirty' ) === -1 ) {
					node.disabled = true;
				}
			}
		}
		/*]]>*/
	</script>
</div>

</body>
</html>